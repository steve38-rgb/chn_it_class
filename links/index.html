<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>好用連結 - 資科補充 HUB</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
</head>

<body>
    <!-- 導覽列 -->
    <nav id="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">資科補充<span> HUB</span></a>
            <ul class="nav-links">
                <li class="dropdown">
                    <a href="../index.html" class="dropbtn">首頁 <i class="arrow down"></i></a>
                    <div class="dropdown-content">
                        <a href="../index.html#rules">課堂規定</a>
                        <a href="../index.html#links">常用帳號</a>
                        <a href="../index.html#past">過往活動</a>
                    </div>
                </li>
                <li><a href="../grade1/index.html" class="nav-btn">一年級</a></li>
                <li><a href="../grade2/index.html" class="nav-btn">二年級</a></li>
                <li><a href="../grade3/index.html" class="nav-btn">三年級</a></li>
                <li><a href="../tools/index.html" class="nav-btn">小工具</a></li>
                <li><a href="index.html" class="nav-btn active">好用連結</a></li>
                <li><a href="#" class="nav-btn">特別課程</a></li>
            </ul>
            <div class="menu-toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <div id="page-wrapper">
        <header class="hero">
            <div class="hero-content">
                <h1>網路<span>好用連結</span></h1>
                <p>精選優質網路資源，協助你探索更廣闊的資訊國度。</p>
            </div>
        </header>

        <!-- 快速導覽列 -->
        <nav id="quick-nav-bar" class="quick-nav" style="display: none;">
            <div class="container" id="quick-nav-container">
                <span class="quick-nav-title">快速前往：</span>
                <!-- 由 JS 動態生成 -->
            </div>
        </nav>

        <main class="container">
            <div id="links-container" class="fade-in">
                <!-- 這裡將由 JavaScript 從 Google Sheet 動態載入 -->
                <div class="loading-state" style="text-align: center; padding: 50px;">
                    <p>正在從雲端同步資源連結...</p>
                </div>
            </div>
        </main>

        <footer>
            <div class="container">
                <p>&copy; 2026 資科補充教學網站. Designed for Classroom Excellence.</p>
            </div>
        </footer>
    </div>
    <script src="../main.js"></script>
    <script>
        // 設定區
        var CONFIG = {
            GAS_API: 'https://script.google.com/macros/s/AKfycbwrNC6_JNh706qZrd0C4tBDYPJMQSVthgs_RsN6oMoAxT1DkkCLBN1Q7bZ4wNcfRTPYKw/exec',
            SHEET_NAME: '好用連結'
        };

        async function fetchLinks() {
            var container = document.getElementById('links-container');
            if (!container) return;

            try {
                var url = CONFIG.GAS_API + '?sheet=' + CONFIG.SHEET_NAME;
                var response = await fetch(url);
                var data = await response.json();

                if (data && data.length > 0) {
                    renderLinks(data);
                } else {
                    container.innerHTML = '<p style="text-align:center;">目前尚無連結資料。</p>';
                }
            } catch (error) {
                console.error('Fetch error:', error);
                container.innerHTML = '<p style="text-align:center; color:#ef4444;">連接失敗：' + error.message + '<br>請檢查網路、GAS 部署設定（需設定為「任何人」皆可存取）以及瀏覽器是否阻擋了腳本。</p>';
            }
        }

        function renderLinks(data) {
            var container = document.getElementById('links-container');
            var quickNav = document.getElementById('quick-nav-bar');
            var quickNavContainer = document.getElementById('quick-nav-container');

            container.innerHTML = '';
            quickNavContainer.innerHTML = '<span class="quick-nav-title">快速前往：</span>';

            // 按大標題分組
            var groups = {};
            var titles = [];
            data.forEach(function (item) {
                var title = item['大標題'] || '其他資源';
                if (!groups[title]) {
                    groups[title] = [];
                    titles.push(title);
                }
                groups[title].push(item);
            });

            // 渲染快速導覽
            if (titles.length > 1) {
                quickNav.style.display = 'block';
                titles.forEach(function (title, index) {
                    var anchorId = 'group-' + index;
                    var navBtn = document.createElement('a');
                    navBtn.className = 'quick-nav-item';
                    navBtn.href = '#' + anchorId;
                    navBtn.textContent = title;
                    quickNavContainer.appendChild(navBtn);
                });
            } else {
                quickNav.style.display = 'none';
            }

            // 渲染各組
            titles.forEach(function (title, index) {
                var links = groups[title];
                var section = document.createElement('section');
                var anchorId = 'group-' + index;
                section.className = 'section link-group-section';
                section.id = anchorId;

                var gridHtml = '<div class="link-grid">';
                links.forEach(function (link) {
                    gridHtml +=
                        '<a href="' + link['連結url'] + '" target="_blank" class="link-card">' +
                        '<h4>' + link['連結名稱'] + '</h4>' +
                        '</a>';
                });
                gridHtml += '</div>';

                section.innerHTML =
                    '<h2 class="section-title" style="text-align: left; font-size: 1.5rem; margin-bottom: 20px;">' + title + '</h2>' +
                    gridHtml;

                container.appendChild(section);
            });

            // 如果有導覽按鈕，重新綁定平滑捲動事件
            if (typeof rebindEvents === 'function') {
                rebindEvents();
            }
        }

        // 初始載入
        fetchLinks();

        // 監聽 SPA 跳轉事件
        document.addEventListener('page-switched', fetchLinks);
    </script>
</body>

</html>